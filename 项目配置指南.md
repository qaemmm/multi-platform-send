# 字流项目完整配置指南

## 📋 项目概述

**字流** 是一个AI驱动的多平台内容发布工具，支持将文章一键发布到微信公众号、知乎、掘金、知识星球、CSDN、小红书等平台。

### 🎯 核心功能
- Markdown编辑器 + 实时预览
- 多平台内容适配和发布
- 浏览器插件自动填充
- 云端图片存储和管理
- 用户订阅和权限管理

---

## 🔧 必需配置清单

### 🚨 **第一优先级：基础服务（网站运行必需）**

#### 1. **GitHub账号** ✅ (已拥有)
- **用途**: 代码托管和部署
- **网址**: [github.com](https://github.com)
- **状态**: 已配置

#### 2. **Vercel账号** ✅ (已拥有)
- **用途**: 网站部署和托管
- **网址**: [vercel.com](https://vercel.com)
- **状态**: 已配置

#### 3. **Turso数据库** ⚠️ (急需配置)
- **用途**: 存储用户数据、文章内容、配置信息
- **网址**: [turso.tech](https://turso.tech)
- **费用**: 免费额度足够
- **必需性**: 🔴 **必需** - 没有数据库网站无法正常工作

---

### 🔧 **基础配置环境变量**

在Vercel项目中配置以下环境变量：

```bash
# ===========================================
# 🔥 核心配置（网站运行必需）
# ===========================================

# NextAuth 认证配置
NEXTAUTH_SECRET="ziliu-super-secret-key-2025-at-least-32-characters-long"
NEXTAUTH_URL="https://ziliu.huiouye.asia"

# 网站地址配置
NEXT_PUBLIC_APP_URL="https://ziliu.huiouye.asia"
NEXT_PUBLIC_API_BASE_URL="https://ziliu.huiouye.asia"

# Turso 数据库配置
TURSO_DATABASE_URL="libsql://your-database-name.turso.io"
TURSO_AUTH_TOKEN="your-turso-auth-token"

# 运行环境
NODE_ENV="production"
```

---

## 📸 **第二优先级：图片存储（图片功能必需）**

### **可选存储方案（选择一个）**

#### 方案A: Cloudflare R2 (推荐)
- **用途**: 存储用户上传的图片
- **网址**: [cloudflare.com](https://cloudflare.com)
- **费用**: 免费额度10GB/月
- **必需性**: 🟡 **图片功能必需** - 没有则图片上传功能不可用

```bash
# Cloudflare R2 配置
R2_ACCOUNT_ID="your-cloudflare-account-id"
R2_ACCESS_KEY_ID="your-r2-access-key-id"
R2_SECRET_ACCESS_KEY="your-r2-secret-access-key"
R2_BUCKET_NAME="your-bucket-name"
R2_PUBLIC_URL="https://your-custom-domain.com"  # 可选
```

#### 方案B: 其他存储方案 (可选)
```bash
# 七牛云存储
QINIU_ACCESS_KEY="your-qiniu-access-key"
QINIU_SECRET_KEY="your-qiniu-secret-key"
QINIU_BUCKET="your-qiniu-bucket"
QINIU_DOMAIN="your-qiniu-domain"
QINIU_ZONE="Zone_z0"

# 腾讯云COS
TENCENT_SECRET_ID="your-tencent-secret-id"
TENCENT_SECRET_KEY="your-tencent-secret-key"
TENCENT_BUCKET="your-tencent-bucket"
TENCENT_REGION="ap-beijing"
TENCENT_DOMAIN="your-tencent-domain"

# 阿里云OSS
ALIYUN_ACCESS_KEY_ID="your-aliyun-access-key-id"
ALIYUN_ACCESS_KEY_SECRET="your-aliyun-access-key-secret"
ALIYUN_BUCKET="your-aliyun-bucket"
ALIYUN_REGION="oss-cn-beijing"
ALIYUN_DOMAIN="your-aliyun-domain"

# GitHub存储 (适合小规模)
GITHUB_TOKEN="your-github-token"
GITHUB_OWNER="your-github-username"
GITHUB_REPO="your-repo-name"
GITHUB_BRANCH="main"
GITHUB_PATH="images"
```

---

## 💳 **第三优先级：付费功能（商业化必需）**

### **Stripe支付系统** (可选)
- **用途**: 处理专业版订阅支付
- **网址**: [stripe.com](https://stripe.com)
- **费用**: 按实际交易收费
- **必需性**: 🟢 **可选** - 用于收费功能

```bash
# Stripe 支付配置
STRIPE_PUBLIC_KEY="pk_test_xxxxxxxxxxxxxx"
STRIPE_SECRET_KEY="sk_test_xxxxxxxxxxxxxx"
STRIPE_WEBHOOK_SECRET="whsec_xxxxxxxxxxxxxx"

# 价格配置（已在代码中配置）
# 专业版月付: $19.9/月
# 专业版年付: $199/年
```

---

## 🤖 **第四优先级：AI功能增强（可选）**

### **OpenAI集成** (可选)
- **用途**: AI内容生成和优化
- **网址**: [openai.com](https://openai.com)
- **费用**: 按使用量收费
- **必需性**: 🟢 **可选** - AI增强功能

```bash
# OpenAI 配置
OPENAI_API_KEY="your-openai-api-key"
OPENAI_BASE_URL="https://api.openai.com/v1"
```

---

## 📊 **其他可选配置**

### **邮件服务** (可选)
```bash
# Resend 邮件服务
RESEND_API_KEY="re_xxxxxxxxxxxxxx"
FROM_EMAIL="noreply@ziliu.online"
```

### **分析服务** (可选)
```bash
# Google Analytics
GOOGLE_ANALYTICS_ID="G-XXXXXXXXXX"

# Umami 分析
UMAMI_WEBSITE_ID="your-umami-website-id"
UMAMI_SCRIPT_URL="https://umami.your-domain.com/script.js"
```

### **管理功能** (可选)
```bash
# 管理员邮箱（用于兑换码等功能）
ADMIN_EMAILS="admin1@example.com,admin2@example.com"

# 定时任务密钥
CRON_SECRET="your-cron-secret-key"

# 自动清理天数
AUTO_CLEANUP_DAYS="90"
```

---

## 🎯 **快速部署指南**

### **步骤1：基础配置（立即执行）**

1. **注册Turso数据库**
   - 访问 [turso.tech](https://turso.tech)
   - GitHub登录 → Create Database
   - 选择区域（推荐：香港或新加坡）
   - 获取数据库连接信息

2. **配置Vercel环境变量**
   ```bash
   NEXTAUTH_SECRET="ziliu-super-secret-key-2025-long-enough"
   NEXTAUTH_URL="https://ziliu.huiouye.asia"
   NEXT_PUBLIC_APP_URL="https://ziliu.huiouye.asia"
   NEXT_PUBLIC_API_BASE_URL="https://ziliu.huiouye.asia"
   TURSO_DATABASE_URL="libsql://your-db-name.turso.io"
   TURSO_AUTH_TOKEN="your-auth-token"
   ```

3. **重新部署Vercel项目**
   - Vercel控制台 → Deployments → Redeploy

### **步骤2：图片功能配置（后续添加）**

1. **注册Cloudflare**
   - 访问 [cloudflare.com](https://cloudflare.com)
   - 创建R2存储桶
   - 生成API密钥

2. **添加图片存储配置**
   ```bash
   R2_ACCOUNT_ID="your-account-id"
   R2_ACCESS_KEY_ID="your-access-key-id"
   R2_SECRET_ACCESS_KEY="your-secret-key"
   R2_BUCKET_NAME="your-bucket-name"
   ```

### **步骤3：付费功能配置（商业化时添加）**

1. **注册Stripe账号**
   - 访问 [stripe.com](https://stripe.com)
   - 获取API密钥
   - 配置Webhook

2. **添加支付配置**
   ```bash
   STRIPE_PUBLIC_KEY="pk_test_xxx"
   STRIPE_SECRET_KEY="sk_test_xxx"
   STRIPE_WEBHOOK_SECRET="whsec_xxx"
   ```

---

## 🔍 **故障排查**

### **常见错误及解决方案**

#### 500错误 - 环境变量缺失
- **检查**: NEXTAUTH_SECRET 长度是否≥32字符
- **检查**: 是否缺少TURSO数据库配置
- **解决**: 补全必需环境变量后重新部署

#### 数据库连接失败
- **检查**: TURSO_DATABASE_URL 和 TURSO_AUTH_TOKEN 是否正确
- **解决**: 重新生成Turso认证令牌

#### 图片上传失败
- **检查**: R2相关配置是否完整
- **解决**: 配置任意一种图片存储方案

#### 登录失败
- **检查**: NEXTAUTH_URL 是否与访问域名一致
- **解决**: 确保域名完全匹配（包括http/https）

---

## 📞 **技术支持**

如果在配置过程中遇到问题：

1. **查看Vercel日志**: Functions标签页查看详细错误
2. **检查浏览器控制台**: F12查看具体错误信息
3. **参考项目文档**: 查看 README.md 和相关配置文件
4. **联系开发者**: 通过GitHub Issues寻求帮助

---

## 📋 **配置检查清单**

### ✅ **基础运行检查**
- [ ] GitHub账号已配置
- [ ] Vercel项目已创建
- [ ] Turso数据库已创建
- [ ] 核心环境变量已配置
- [ ] 网站能正常访问

### ✅ **功能完整性检查**
- [ ] 用户注册登录功能
- [ ] 文章创建和编辑
- [ ] 图片上传功能
- [ ] 多平台发布功能
- [ ] 订阅和支付功能

### ✅ **生产环境检查**
- [ ] 域名解析正常
- [ ] HTTPS证书生效
- [ ] 数据库连接稳定
- [ ] 图片存储正常
- [ ] 支付功能正常

---

**文档版本**: v1.0
**创建时间**: 2025-09-26
**最后更新**: 2025-09-26
**维护者**: 字流开发团队